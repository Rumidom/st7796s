/dts-v1/;
/plugin/;

/*
MOSI      	PH7 SPI1_MOSI
MISO      	PH8 SPI1_MISO
CLK       	PH6 SPI1_CLK
TFT_CS    	PH5
DC        	PH4 
RST       	PI0
TOUCH_CS  	PH9
TOUCH_IRQ 	PI15
LED       	3.3V
BEEPER		PL2
*/

/ {

	fragment@0 {
		target-path = "/aliases";

		__overlay__ {
			spi1 = "/soc/spi@5011000";
		};
	};

	fragment@1 {
		target = <0xffffffff>;

		__overlay__ {
			status = "okay";
			#address-cells = <0x01>;
			#size-cells = <0x00>;
			pinctrl-names = "default";
			pinctrl-0 = <0xffffffff 0xffffffff 0xffffffff>;
		};
	};

	__fixups__ {
		spi1 = "/fragment@1:target:0";
		spi1_pins = "/fragment@1/__overlay__:pinctrl-0:0";
		spi1_cs0_pin = "/fragment@1/__overlay__:pinctrl-0:4";
		spi1_cs1_pin = "/fragment@1/__overlay__:pinctrl-0:8";
	};
};

/ {
   /* compatible = "allwinner,h616\0arm,sun50iw9p1";*/

    fragment@1 {
	target-path = "/soc/spi@5011000";
	__overlay__ {
	    num-cs = <2>;  
	    status = "okay";
	    #address-cells = <1>;
	    #size-cells = <0>;

	    st7796: st7796s@0{
			compatible = "sitronix,st7796s";
			reg = <0>;
			spi-max-frequency = <16000000>;
			fps = <30>;
			buswidth = <8>;
			reset-gpios = <&pio 8 0 1>;  /* PI0 */
			dc-gpios = <&pio 7 4 0>;     /* PH4 */
			rotate = <0xB4>;
			debug = <1>;
			init = <0x10000b0 0x00 // Interface Mode Control
					0x1000011  // Sleep Out
					0x20000ff  // Delay (255ms)
					0x10000C0 0x0D 0x0D  // Power Control 1
					0x10000C1 0x43  // Power Control 2
					0x10000C5 0x00 0x48 0x80  // VCOM Control 1
					0x10000C7 0x00  // VCOM Control 2
					0x1000036 0x28  // Memory Access Control (Rotacao)
					0x100003A 0x55  // Pixel Format Set (16bit)
					0x10000B1 0xB0 0x11  // Frame Rate Control
					0x10000F0 0x01 // Enable Extended Comand Set
					0x10000F6 0x00 0x01 0x32 // SPI ilInterface Control
					0x1000026 0x01 // Gamma Set
					0x10000E0 0x0F 0x31 0x2B 0x0C 0x0E 0x08 0x4E 0xF1 0x37 0x07 0x10 0x03 0x0E 0x09 0x00  // Positive Gamma Correction
					0x10000E1 0x00 0x0E 0x14 0x03 0x11 0x07 0x31 0xC1 0x48 0x08 0x0F 0x0C 0x31 0x36 0x0F  // Negative Gamma Correction
					0x10000B6 0x02 0x02 0x3B  // Display Function Control
					0x1000011  // Sleep Out
					0x20000ff  // Delay (255ms)
					0x1000029>; // Display ON
            };
	    };
	};
    };

    fragment@1 {
	target-path = "/soc/spi@5011000";
	__overlay__ {
		#address-cells = <1>;
		#size-cells = <0>;
		status = "okay";
			ads7846@0 {
				compatible = "ti,ads7846";
				reg = <1>;
				status = "okay";
				spi-max-frequency = <1000000>;
				interrupts = <8 15 2>; /* high-to-low edge triggered */
				interrupt-parent = <&pio>;   /* PI15 */
				pendown-gpio = <&pio 8 15 0>;	    

				/* driver defaults, optional */

				ti,keep-vref-on = <1>;
				ti,x-min = /bits/ 16 <00>;
				ti,x-max = /bits/ 16 <0xFFF>;
				ti,y-min = /bits/ 16 <00>;
				ti,y-max = /bits/ 16 <0xFFF>;
				ti,x-plate-ohms = /bits/ 16 <60>;
				ti,pressure-max = /bits/ 16 <255>;
				ti,swap-xy = <0>;	
			};
		};
    };


};
